<!doctype html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
  <title>Demo - jQuery plugin : Candlesticks Chart</title>
	<link href="css/simple.css" rel="stylesheet" type="text/css" media="screen">
	<script src="js/jquery.js" type="text/javascript"></script>
	<script src="js/jquery.csv.js" type="text/javascript"></script>
	<script src="js/jquery.candlechart.js" type="text/javascript"></script>
</head>

<body>
  <div id="page">
  <header>
	  <h1 id="siteName">Demo - jQuery plugin : Candlesticks Chart</h1>
  </header>

  <div id="contents">
  <section id="main">
  <article>
    <p style="text-align:right;font-size:80%;">
    </p>
    <p>It reads data up to 2010 the end of September 2007 the Nikkei 225 futures (CSV format), and volume Candlesticks
       Show me 50 books in a random period moving average line on the 5th。</p>
    <div class="stage">
      <canvas width="400" height="300" id="cv01"></canvas>
    </div>

    <p>※Google Chrome If, because you can not access the file in the local security issues in default
       It does not work in the local environment  。<br>
       Chrome To start-up options –allow-file-access-from-files It works by adding a。
    </p>

    <div class="stage">
      <canvas width="400" height="300" id="cv02"></canvas>
    </div>

  </article>
  </section>

  <aside></aside>
  </div>

  <footer></footer>
  </div>
</body>
</html>

	<script type="text/javascript">
      var option = {
      'width' : 600,
      'height' : 400,
      'ofX': 40,
      'ofY': 30,
      'bgColor': "#2F4F4F",
      'cdWidth': 5,
      'cdLineColor': "#FFF",
      'cdUpColor': "#FF4500",
      'cdDownColor': "#00CED1",
      'voColor': "#E0FFFF",
      'liColor': "#008080",
      'maColor': "#FFE",
      'liNum': 6,
      'upper' : 15000,
      'lower' : 7000,
      'autoScale' : true
      };

      var option2 = {
      'width' : 500,
      'height' : 250,
      'cdWidth': 4,
      'autoScale' : true
      };

  var csvString="'2010/8/9','9510','9570','9500','9560','42271'\n\
'2010/8/10','9620','9670','9500','9540','67049'\n\
'2010/8/11','9430','9450','9270','9280','79483'\n\
'2010/8/12','9120','9210','9050','9190','85514'\n\
'2010/8/13','9200','9280','9150','9270','56062'\n\
'2010/8/16','9130','9210','9080','9180','54212'\n\
'2010/8/17','9080','9190','9070','9170','52021'\n\
'2010/8/18','9250','9280','9140','9240','69844'\n\
'2010/8/19','9230','9380','9230','9360','70034'\n\
'2010/8/20','9210','9290','9150','9160','64069'";

        // TODO: MUCH better data validation
        var csv = $.csv.toArrays(csvString, {'delimiter' : '\''}); 
        
        var l = csv.length;
        var ticks =[];
        var vol = [];
        var avg = [];
        var candle = 50;
        //var r = parseInt(Math.random()*(l-candle));

        var candleDate = csv[0][0];
        var prvMonth = candleDate.split('/')[1];
        //for(var i = r; i < r + candle ; i++) {
        for(var i=0; i<l; i++) {
          var candle = csv[i];
          candleDate = candle[0];
          var curMonth = candleDate.split('/')[1];
          var volume = candle[5] || 0;
         
          // calculate the moving average 
          var total = 0;
          var numDays = 5; /* sample size, number of previous days considered */
          for (var j = 0 ; j < numDays && i-j > 0 ; j++) {
            total += parseInt(csv[i-j][4]);
          }
          avg.push(total / numDays);
          
          if( curMonth != prvMonth ) {
            ticks.push([candle[1],candle[4],candle[2],candle[3],candle[0]]);
            prvMonth = curMonth;
          } else {
            ticks.push([candle[1],candle[4],candle[2],candle[3]]);
          }
          vol.push(volume);
        }
      
        $("#cv01").candleChart(ticks, option)
          .ccVolume(vol)
          .ccMA(avg, "#FFFFFF");

        $("#cv02").candleChart(option2)
          .ccVolume(vol)
          .ccTick(ticks);

      //})
	</script>
<!--EOF-->
